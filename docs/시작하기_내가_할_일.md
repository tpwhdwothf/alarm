# 🚀 내가 할 일 — 비개발자용 안내

목표가 알림 봇을 쓰려면 **준비 → 설정 → 실행** 순서만 지키면 됩니다.  
아래를 **위에서부터 차례대로** 진행하세요.

---

## 1단계: 준비할 것 (미리 갖춰 두기)

| 준비물 | 어디서 / 어떻게 |
|--------|-----------------|
| **Node.js** | [nodejs.org](https://nodejs.org) 에서 LTS 버전 다운로드 후 설치 |
| **텔레그램 봇 토큰** | 텔레그램에서 [@BotFather](https://t.me/BotFather) 검색 → `/newbot` 입력 → 봇 이름 정한 뒤 나오는 **토큰** 복사 |
| **Supabase** | [supabase.com](https://supabase.com) 회원가입 → 새 프로젝트 생성 → **Project URL** 과 **anon key** 복사 |
| **KIS API 키** | 한국투자증권 계좌 + [KIS 개발자 포털](https://apiportal.koreainvestment.com) 가입 후 **앱 키(App Key)** 와 **앱 시크릿(App Secret)** 발급 (자세한 건 [국장_KIS_연동_가이드.md](국장_KIS_연동_가이드.md) 참고) |

---

## 2단계: 프로젝트 폴더에서 터미널 열기

- 이 프로젝트가 들어 있는 폴더(예: `alarm` 폴더)를 연 다음,
- **터미널**(또는 Cursor/VS Code 터미널, 명령 프롬프트)을 **그 폴더 안에서** 열어 두세요.

---

## 3단계: 패키지 설치 (최초 1번만)

터미널에 아래를 입력하고 Enter 를 누릅니다.

```bash
npm install
```

끝날 때까지 기다렸다가, 에러 메시지가 없으면 다음 단계로 넘어가면 됩니다.

---

## 4단계: `.env` 파일 만들고 값 넣기

1. 프로젝트 **맨 바깥 폴더**(`alarm` 등) 안에 **`.env`** 라는 이름의 파일을 만듭니다.  
   (이미 있으면 그 파일을 엽니다.)

2. 아래 내용을 **복사해서** `.env` 파일에 붙여 넣은 뒤,  
   `여기에_...` 부분만 **본인 값**으로 바꿉니다.

```env
TELEGRAM_BOT_TOKEN=여기에_BotFather가_준_봇_토큰_붙여넣기
SUPABASE_URL=여기에_Supabase_Project_URL_붙여넣기
SUPABASE_ANON_KEY=여기에_Supabase_anon_key_붙여넣기

KIS_APP_KEY=여기에_KIS_앱키_붙여넣기
KIS_APP_SECRET=여기에_KIS_앱시크릿_붙여넣기
```

- **주의**: `=` 앞뒤에 공백 넣지 말고, 따옴표도 붙이지 마세요.
- KIS 키는 [국장_KIS_연동_가이드.md](국장_KIS_연동_가이드.md) 에서 발급 방법을 단계별로 볼 수 있습니다.

---

## 5단계: Supabase에 테이블 만들기 (최초 1번만)

1. [Supabase 대시보드](https://supabase.com/dashboard) 에 들어가서 본인 프로젝트를 엽니다.
2. 왼쪽 메뉴에서 **SQL Editor** (또는 **SQL**) 를 클릭합니다.
3. 이 프로젝트 안에 있는 **`supabase-schema.sql`** 파일을 메모장 등으로 열어서 **전체 내용**을 복사합니다.
4. Supabase SQL 편집기에 **붙여넣기** 한 뒤 **Run** (실행) 버튼을 누릅니다.
5. 에러 없이 완료되면, `user_settings`, `targets`, `alert_logs` 테이블이 생성된 것입니다.

---

## 6단계: 두 가지를 “켜 두기”

봇이 동작하려면 **봇**과 **시세 조회**가 **동시에** 돌아가야 합니다.  
터미널을 **두 개** 열어서 각각 아래처럼 실행하세요.

### 터미널 1 — 봇 켜기

```bash
npm run dev
```

- `Telegram 봇이 시작되었습니다.` 같은 메시지가 보이면 **봇이 켜진 것**입니다.
- 이 터미널은 **끄지 말고** 그대로 두세요.

### 터미널 2 — 시세 조회 켜기 (국장·미장 모두)

**새 터미널**을 하나 더 연 다음, 같은 프로젝트 폴더로 이동해서 아래를 입력합니다.

```bash
npm run worker:kis
```

- `[KIS] 통합 시세 워커 시작 (국장 + 미장)` 같은 메시지가 보이면 **시세 조회가 켜진 것**입니다.
- 이 터미널도 **끄지 말고** 그대로 두세요.

> **정리**:  
> - **터미널 1** = 봇 (명령 받고 알림 보내는 역할)  
> - **터미널 2** = 시세 조회 (목표가 도달 여부 확인)  
> 두 개 다 켜져 있어야 알림이 제대로 옵니다.

---

## 7단계: 텔레그램에서 봇 사용하기

1. 텔레그램에서 **본인이 만든 봇**을 검색해서 대화를 시작합니다.
2. **그룹**을 하나 만들고, 그 그룹에 **봇을 초대**합니다.
3. 그룹 채팅방에서 아래 명령을 입력해 봇을 설정합니다.

| 입력 | 설명 |
|------|------|
| `/setgroup` | **이 그룹**을 “알림 받을 그룹”으로 지정 (그룹에서만 입력) |
| `/등록 005930 70000 72000` | 삼성전자(국장) 1차 7만, 2차 7만2천 목표가 등록 |
| `/등록 AAPL 180 190` | 애플(미장) 180, 190 목표가 등록 |
| `/목록` | 지금 등록한 종목·목표가 목록 보기 |

- `/setgroup` 은 **반드시 알림 받을 그룹**에서 입력해야 합니다.
- `/등록`, `/목록` 등은 **봇과 1:1 채팅(DM)** 에서 쓰는 것을 권장합니다 (설정에 따라 그룹에서도 가능할 수 있음).

---

## 8단계: 알림 확인

- 시세가 **등록한 목표가에 도달**하면, `/setgroup` 했던 **그룹**으로 알림이 옵니다.
- 터미널 1(봇), 터미널 2(worker:kis) 가 **둘 다 실행 중**이어야 알림이 갑니다.

---

## 자주 하는 실수

- **「목표가를 저장하는 중 오류가 발생했어요」**
  → Supabase **RLS(행 수준 보안)** 때문에 저장이 막힌 경우가 많습니다.  
  → Supabase 대시보드 → **SQL Editor** 에서 **`supabase-schema.sql`** 파일 **전체**를 다시 복사해 붙여 넣고 **Run** 해 보세요. (테이블은 이미 있어도 그대로 두고, 맨 아래 **RLS 정책**만 추가됩니다.)  
  → 그래도 안 되면 봇이 알려주는 **오류 메시지**를 확인해 보세요.

- **목표가 도달했는데 알림이 안 온다**
  → **터미널 2**에서 `npm run worker:kis` 가 **실행 중**인지 확인하세요. 봇만 켜고 시세 워커를 안 켜면 알림이 가지 않습니다.
  → 터미널 2에 `[KIS] 해외 시세 없음: ABNB` 처럼 나오면, 해당 종목 시세를 KIS에서 못 받는 상태입니다. (API 키·거래시간 확인)
  → 알림이 보낼 때는 터미널 2에 `[알림] ABNB 1차 목표가 도달 ... → 그룹으로 발송` 이 로그로 찍힙니다. 이 로그가 전혀 없으면 시세는 오는데 목표가 조건이 안 맞는 경우일 수 있습니다.
  → 알림 받을 그룹에서 **/setgroup** 을 한 번 실행했는지 확인하세요.

- **알림이 안 온다** (일반)
  → 터미널 2에서 `npm run worker:kis` 를 실행했는지 확인하세요. 봇만 켜고 시세 워커를 안 켜면 알림이 가지 않습니다.

- **봇이 반응이 없다**  
  → 터미널 1에서 `npm run dev` 가 에러 없이 켜져 있는지 확인하세요.  
  → `.env` 의 `TELEGRAM_BOT_TOKEN` 이 BotFather 에서 받은 값과 똑같은지 확인하세요.

- **KIS 로그인/토큰 오류**  
  → `.env` 의 `KIS_APP_KEY`, `KIS_APP_SECRET` 이 포털에서 복사한 값과 일치하는지, 앞뒤 공백이 없는지 확인하세요.  
  → 실전/모의 구분이 필요하면 `KIS_REAL=true`(실전) 또는 `KIS_REAL=false`(모의) 를 `.env` 에 넣을 수 있습니다.

- **수정한 .env 가 반영이 안 된다**  
  → `.env` 를 수정한 뒤에는 **봇이랑 worker 를 모두 종료했다가 다시 실행**해야 합니다.

---

## 요약 체크리스트

- [ ] Node.js 설치됨
- [ ] 텔레그램 봇 토큰, Supabase URL·anon key, KIS 앱키·앱시크릿 준비됨
- [ ] `npm install` 실행함
- [ ] `.env` 파일 만들고 위 값들 넣음
- [ ] Supabase 에 `supabase-schema.sql` 실행해서 테이블 생성함
- [ ] 터미널 1: `npm run dev` 로 봇 실행 중
- [ ] 터미널 2: `npm run worker:kis` 로 시세 워커 실행 중
- [ ] 텔레그램에서 `/setgroup` 후 `/등록 ...` 으로 종목·목표가 등록함

여기까지 하면 **내가 할 일**은 끝입니다.  
더 자세한 명령어는 [README.md](../README.md) 의 “텔레그램 명령 사용법”을 참고하면 됩니다.

**PC 없이 24시간 돌리려면?** → [클라우드_배포_가이드.md](클라우드_배포_가이드.md) 에 무료·저비용 서버 옵션과 장단점이 정리되어 있습니다.
